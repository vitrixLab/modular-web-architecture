<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <base href="/modular-web-architecture/">
  <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ascend Payments Platform - Unified SaaS Payment Gateway</title>

<!-- Favicon -->
<link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/882/882701.png">

<style>/* ===== CSS VARIABLES ===== */
:root {
  /* Colors - Dark Theme (Default) */
  --primary-color: #4361ee;
  --primary-light: #4895ef;
  --primary-dark: #3a0ca3;
  --secondary-color: #7209b7;
  --success-color: #4cc9f0;
  --warning-color: #f8961e;
  --error-color: #f94144;
  
  --bg-primary: #121212;
  --bg-secondary: #1e1e1e;
  --bg-tertiary: #2a2a2a;
  --bg-card: #2a2a2a;
  
  --text-primary: #ffffff;
  --text-secondary: #b0b0b0;
  --text-muted: #888888;
  
  --border-color: #404040;
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  
  --border-radius: 8px;
  --transition: all 0.3s ease;
}

[data-theme="light"] {
  /* Colors - Light Theme */
  --primary-color: #4361ee;
  --primary-light: #4895ef;
  --primary-dark: #3a0ca3;
  --secondary-color: #7209b7;
  --success-color: #4cc9f0;
  --warning-color: #f8961e;
  --error-color: #f94144;
  
  --bg-primary: #f8f9fa;
  --bg-secondary: #ffffff;
  --bg-tertiary: #e9ecef;
  --bg-card: #ffffff;
  
  --text-primary: #212529;
  --text-secondary: #495057;
  --text-muted: #6c757d;
  
  --border-color: #dee2e6;
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

/* ===== BASE STYLES ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  height: 100vh;
  margin: 0;
  font-family: 'Segoe UI', 'Inter', Arial, sans-serif;
  overflow: hidden;
  background-color: var(--bg-primary);
  color: var(--text-primary);
  transition: var(--transition);
  line-height: 1.5;
}

/* ===== LAYOUT ===== */
.app-container {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* ===== SIDEBAR NAVIGATION ===== */
.side-nav {
  width: 260px;
  background-color: var(--bg-secondary);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  transition: var(--transition);
  z-index: 100;
}

.nav-header {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
}

.nav-logo {
  width: 32px;
  height: 32px;
  margin-right: 12px;
  border-radius: 6px;
}

.nav-header h1 {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
}

.nav-menu {
  list-style: none;
  padding: 16px 0;
  flex: 1;
}

.nav-item {
  display: flex;
  align-items: center;
  padding: 14px 20px;
  text-decoration: none;
  color: var(--text-secondary);
  transition: var(--transition);
  border-left: 3px solid transparent;
}

.nav-item:hover {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
}

.nav-item.active {
  background-color: var(--bg-tertiary);
  color: var(--primary-color);
  border-left-color: var(--primary-color);
}

.nav-icon {
  font-size: 18px;
  margin-right: 12px;
  width: 24px;
  text-align: center;
}

.nav-label {
  font-weight: 500;
  font-size: 14px;
}

.user-menu {
  padding: 20px;
  border-top: 1px solid var(--border-color);
  display: flex;
  align-items: center;
}

.user-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background-color: var(--primary-color);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 14px;
}

/* ===== MAIN CONTENT ===== */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.app-header {
  padding: 20px 24px;
  background-color: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-titles h1 {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 4px;
}

.header-titles p {
  color: var(--text-secondary);
  font-size: 14px;
}

/* ===== DASHBOARD CONTENT ===== */
.dashboard-content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
}

.content-header {
  margin-bottom: 24px;
}

.content-header h2 {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 8px;
}

.content-header p {
  color: var(--text-secondary);
  font-size: 16px;
}

/* ===== CARDS GRID ===== */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.dashboard-card {
  background-color: var(--bg-card);
  border-radius: var(--border-radius);
  padding: 20px;
  box-shadow: var(--shadow);
  transition: var(--transition);
  border: 1px solid var(--border-color);
  position: relative;
  overflow: hidden;
}

.dashboard-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.card-header {
  display: flex;
  align-items: center;
  margin-bottom: 16px;
}

.card-icon {
  font-size: 24px;
  margin-right: 12px;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  background-color: rgba(67, 97, 238, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
}

.card-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
}

.metric-display {
  margin-bottom: 16px;
}

.metric-value {
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1.2;
}

.metric-label {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.metric-trend {
  display: inline-flex;
  align-items: center;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  background-color: rgba(76, 201, 240, 0.1);
  color: var(--success-color);
}

.metric-trend.positive {
  background-color: rgba(76, 201, 240, 0.1);
  color: var(--success-color);
}

.metric-trend.negative {
  background-color: rgba(249, 65, 68, 0.1);
  color: var(--error-color);
}

.metric-trend.neutral {
  background-color: rgba(248, 150, 30, 0.1);
  color: var(--warning-color);
}

.metric-breakdown {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.breakdown-item {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
}

.breakdown-label {
  color: var(--text-secondary);
}

.breakdown-value {
  font-weight: 500;
  color: var(--text-primary);
}

.breakdown-value.success {
  color: var(--success-color);
}

.breakdown-value.warning {
  color: var(--warning-color);
}

/* ===== DATA VISUALIZATION STYLES ===== */

/* Status Bar for Clients Card */
.super-thin-hr {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 1px;
  border-radius: 0 0 var(--border-radius) var(--border-radius);
  background-color: var(--success-color);
}

.card-status-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 3px;
  border-radius: 0 0 var(--border-radius) var(--border-radius);
}

.card-status-bar.positive {
  background-color: var(--success-color);
}

.card-status-bar.negative {
  background-color: var(--error-color);
}

.card-status-bar.neutral {
  background-color: var(--warning-color);
}

/* Sparkline Chart for Transactions */
.viz-container {
  margin: 12px 0;
}

.sparkline-chart {
  height: 40px;
  width: 100%;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
}

.sparkline-bar {
  flex: 1;
  margin: 0 1px;
  background-color: var(--primary-color);
  border-radius: 2px 2px 0 0;
  transition: all 0.3s ease;
}

.sparkline-bar:hover {
  opacity: 0.8;
  transform: scaleY(1.05);
}

/* Progress Bar for API Performance */
.progress-bar-container {
  margin: 16px 0;
}

.progress-bar-track {
  height: 8px;
  background-color: var(--bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
  margin-top: 8px;
}

.progress-bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}

.progress-bar-fill.success {
  background-color: var(--success-color);
}

.progress-bar-fill.warning {
  background-color: var(--warning-color);
}

.progress-bar-fill.error {
  background-color: var(--error-color);
}

/* Mini Bar Chart for Revenue */
.bar-chart {
  height: 40px;
  display: flex;
  align-items: flex-end;
  gap: 4px;
  margin: 12px 0;
}

.bar-chart-item {
  flex: 1;
  border-radius: 2px 2px 0 0;
  transition: all 0.3s ease;
  position: relative;
}

.bar-chart-item:hover {
  opacity: 0.8;
  transform: scaleY(1.05);
}

.bar-chart-item::after {
  content: attr(data-label);
  position: absolute;
  bottom: -20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 10px;
  color: var(--text-muted);
  white-space: nowrap;
}

.metric-value-label {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* ===== DASHBOARD SECTIONS ===== */
.dashboard-section {
  margin-bottom: 32px;
}

.dashboard-header {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 16px;
  color: var(--text-primary);
}

/* ===== ACTIVITY LIST ===== */
.activity-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.activity-item {
  display: flex;
  align-items: center;
  padding: 16px;
  background-color: var(--bg-card);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  transition: var(--transition);
  border: 1px solid var(--border-color);
}

.activity-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

.activity-icon {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 12px;
  font-size: 14px;
}

.activity-icon.success {
  background-color: rgba(76, 201, 240, 0.1);
  color: var(--success-color);
}

.activity-icon.pending {
  background-color: rgba(248, 150, 30, 0.1);
  color: var(--warning-color);
}

.activity-content {
  flex: 1;
}

.activity-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.activity-description {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 4px;
}

.activity-time {
  font-size: 12px;
  color: var(--text-muted);
}

.activity-badge {
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
}

.activity-badge.enterprise {
  background-color: rgba(67, 97, 238, 0.1);
  color: var(--primary-color);
}

.activity-badge.growth {
  background-color: rgba(114, 9, 183, 0.1);
  color: var(--secondary-color);
}

.activity-badge.startup {
  background-color: rgba(248, 150, 30, 0.1);
  color: var(--warning-color);
}

/* ===== HEALTH GRID ===== */
.health-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px;
}

.health-item {
  display: flex;
  align-items: center;
  padding: 16px;
  background-color: var(--bg-card);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  transition: var(--transition);
  border: 1px solid var(--border-color);
}

.health-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

.health-status {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 12px;
}

.health-status.success {
  background-color: var(--success-color);
  box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
}

.health-status.warning {
  background-color: var(--warning-color);
  box-shadow: 0 0 0 3px rgba(248, 150, 30, 0.2);
}

.health-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.health-metric {
  font-size: 13px;
  color: var(--text-secondary);
}

/* ===== FOOTER ===== */
.app-footer {
  padding: 16px 24px;
  text-align: center;
  font-size: 14px;
  color: var(--text-muted);
  border-top: 1px solid var(--border-color);
  background-color: var(--bg-secondary);
}

/* ===== ENHANCED THEME TOGGLE STYLES ===== */
.theme-toggle-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 24px;
  padding: 4px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.theme-toggle-container:hover {
  transform: translateY(-1px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.theme-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px 8px 8px;
  background: transparent;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  color: var(--text-primary);
  font-size: 14px;
  font-weight: 500;
}

.theme-toggle:hover {
  background: var(--bg-tertiary);
}

.theme-toggle:focus-visible {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
}

.toggle-track {
  position: relative;
  width: 48px;
  height: 24px;
  background: var(--bg-tertiary);
  border-radius: 12px;
  transition: all 0.3s ease;
  border: 1px solid var(--border-color);
}

.toggle-thumb {
  position: absolute;
  top: 2px;
  left: 2px;
  width: 20px;
  height: 20px;
  background: var(--primary-color);
  border-radius: 50%;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  transform: translateX(0);
}

/* Light mode state */
[data-theme="light"] .toggle-thumb {
  transform: translateX(24px);
  background: var(--primary-color);
}

.toggle-icon {
  font-size: 12px;
  line-height: 1;
  transition: all 0.3s ease;
  position: absolute;
}

.toggle-icon.sun {
  opacity: 0;
  transform: scale(0.8);
}

.toggle-icon.moon {
  opacity: 1;
  transform: scale(1);
}

[data-theme="light"] .toggle-icon.sun {
  opacity: 1;
  transform: scale(1);
}

[data-theme="light"] .toggle-icon.moon {
  opacity: 0;
  transform: scale(0.8);
}

.toggle-label {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
  transition: color 0.3s ease;
  white-space: nowrap;
}

/* System preference button */
.theme-preference {
  display: flex;
  align-items: center;
}

.preference-btn {
  width: 32px;
  height: 32px;
  border: none;
  background: transparent;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  color: var(--text-secondary);
}

.preference-btn:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.preference-btn.active {
  background: var(--primary-color);
  color: white;
}

.preference-icon {
  font-size: 14px;
  line-height: 1;
}

/* ===== LOADING STATES ===== */
.skeleton-loader {
  background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--border-color) 50%, var(--bg-tertiary) 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: 4px;
}

@keyframes loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* ===== ANIMATIONS ===== */
@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOut {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

@keyframes highlight {
  0% { background-color: transparent; }
  50% { background-color: rgba(67, 97, 238, 0.1); }
  100% { background-color: transparent; }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 1024px) {
  .side-nav {
    width: 80px;
  }
  
  .nav-label,
  .nav-header h1 {
    display: none;
  }
  
  .nav-icon {
    margin-right: 0;
    font-size: 18px;
  }
  
  .nav-item {
    justify-content: center;
    padding: 16px 0;
  }

  .theme-toggle-container {
    right: 70px;
    top: 16px;
  }
}

@media (max-width: 768px) {
  .app-container {
    flex-direction: column;
  }
  
  .side-nav {
    width: 100%;
    height: auto;
    padding: 0;
  }
  
  .nav-menu {
    display: flex;
    overflow-x: auto;
    padding: 0;
  }
  
  .nav-item {
    flex: 1;
    min-width: 80px;
    flex-direction: column;
    padding: 12px 8px;
    border-left: none;
    border-bottom: 3px solid transparent;
  }
  
  .nav-item.active,
  .nav-item:hover {
    border-left: none;
    border-bottom-color: var(--primary-color);
  }
  
  .nav-icon {
    margin-right: 0;
    margin-bottom: 4px;
    font-size: 18px;
  }
  
  .nav-label {
    font-size: 12px;
    display: block;
  }
  
  .cards-grid {
    grid-template-columns: 1fr;
  }
  
  .header-content {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .user-menu {
    align-self: flex-end;
  }

  .theme-toggle-container {
    position: absolute;
    top: 16px;
    right: 16px;
    padding: 3px;
  }

  .theme-toggle {
    padding: 6px 10px 6px 6px;
    font-size: 13px;
  }

  .toggle-track {
    width: 44px;
    height: 22px;
  }

  .toggle-thumb {
    width: 18px;
    height: 18px;
  }

  [data-theme="light"] .toggle-thumb {
    transform: translateX(22px);
  }

  .toggle-label {
    font-size: 13px;
  }

  /* Hide label on very small screens */
  @media (max-width: 480px) {
    .toggle-label {
      display: none;
    }
    
    .theme-toggle {
      padding: 6px;
    }
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .theme-toggle-container,
  .theme-toggle,
  .toggle-track,
  .toggle-thumb,
  .toggle-icon,
  .dashboard-card,
  .activity-item,
  .health-item {
    transition: none;
    animation: none;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .theme-toggle-container {
    border: 2px solid var(--text-primary);
  }

  .toggle-track {
    border: 2px solid var(--text-primary);
  }
}

/* Dark mode specific adjustments */
[data-theme="dark"] .toggle-track {
  background: linear-gradient(135deg, #2A2A2A 0%, #1E1E1E 100%);
}

[data-theme="light"] .toggle-track {
  background: linear-gradient(135deg, #E9ECEF 0%, #F8F9FA 100%);
}

/* Focus indicators for accessibility */
.theme-toggle:focus:not(:focus-visible) {
  outline: none;
}

/* Loading state */
.theme-toggle.loading {
  opacity: 0.7;
  pointer-events: none;
}

.theme-toggle.loading .toggle-thumb {
  animation: pulse 1.5s ease-in-out infinite;
}
</style>
</head>

<body>
  <!-- Theme Toggle Container -->
  <div class="theme-toggle-container">
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme" title="Switch between dark and light mode">
      <div class="toggle-track">
        <div class="toggle-thumb">
          <span class="toggle-icon sun">‚òÄÔ∏è</span>
          <span class="toggle-icon moon">üåô</span>
        </div>
      </div>
      <span class="toggle-label" id="toggleLabel">Dark Mode</span>
    </button>
    
    <!-- System Theme Detection -->
    <div class="theme-preference" id="themePreference">
      <button class="preference-btn" data-theme="system" aria-label="Use system theme">
        <span class="preference-icon">‚öôÔ∏è</span>
      </button>
    </div>
  </div>

  <!-- Main Dashboard -->
  <div class="app-container">
    <nav class="side-nav" aria-label="Main navigation">
  <div class="nav-header">
    <img src="https://cdn-icons-png.flaticon.com/512/882/882701.png" 
         alt="Ascend Payments Logo" 
         class="nav-logo">
    <h1>Ascend Payments</h1>
  </div>
  <ul class="nav-menu">
    <li>
      <a class="nav-item active" data-route="dashboard">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Dashboard</span>
      </a>
    </li>
    <li>
      <a class="nav-item" data-route="clients">
        <span class="nav-icon">üë•</span>
        <span class="nav-label">Clients</span>
      </a>
    </li>
    <li>
      <a class="nav-item" data-route="transactions">
        <span class="nav-icon">üí≥</span>
        <span class="nav-label">Transactions</span>
      </a>
    </li>
    <li>
      <a class="nav-item" data-route="api">
        <span class="nav-icon">üîß</span>
        <span class="nav-label">API Management</span>
      </a>
    </li>
    <li>
      <a class="nav-item" data-route="analytics">
        <span class="nav-icon">üìä</span>
        <span class="nav-label">Analytics</span>
      </a>
    </li>
  </ul> 
  <div class="user-menu">
    <div class="user-avatar">AP</div>
  </div> 
</nav>
    
    <!-- Main Content -->
    <div class="main-content">
      <header class="app-header">
  <div class="header-content">
    <div class="header-titles">
      <h1>Ascend Payments Platform</h1>
      <p>Enterprise SaaS Payment Gateway Dashboard</p>
    </div>
  </div>
</header>

      <!-- Dashboard Content -->
      <main class="dashboard-content">
        <div class="content-header">
          <h2>Platform Overview</h2>
          <p>Monitor your payment gateway performance and client activities in real-time.</p>
        </div>

        <!-- Metrics Cards Grid -->
        <div id="metricsCardsContainer" class="cards-grid">
          <!-- Metrics cards will be injected by JavaScript -->
        </div>

        <!-- Recent Activity Section -->
        <div class="dashboard-section">  
          <h3 class="dashboard-header">Recent Client Onboarding</h3>
          <div id="activityListContainer" class="activity-list">
            <!-- Activity items will be injected by JavaScript -->

          </div>
        </div>

        <!-- System Health Section -->
        <div class="dashboard-section">   
          <h3 class="dashboard-header">System Health & Monitoring</h3>
          <div id="healthStatusContainer" class="health-grid">
            <!-- Health status items will be injected by JavaScript -->
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer class="app-footer">
        Ascend Payments Platform ‚Ä¢ <span id="currentTheme">Dark Mode</span> ‚Ä¢ v1.0.0
      </footer>
    </div>
  </div>

  <script>
// theme-manager.js
// ===== ENHANCED THEME MANAGER =====
const EnhancedThemeManager = {
  currentTheme: 'dark',
  systemPreference: null,
  
  init() {
    this.detectSystemPreference();
    this.loadThemePreference();
    this.setupEventListeners();
    this.applyTheme(this.currentTheme);
    this.setupIntersectionObserver();
  },
  
  detectSystemPreference() {
    this.systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    
    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      this.systemPreference = e.matches ? 'dark' : 'light';
      if (this.currentTheme === 'system') {
        this.applyTheme(this.systemPreference);
      }
    });
  },
  
  loadThemePreference() {
    const savedTheme = localStorage.getItem('ascend-theme') || 'dark';
    this.currentTheme = savedTheme;
  },
  
  setupEventListeners() {
    const toggleBtn = document.getElementById('themeToggle');
    const preferenceBtn = document.querySelector('.preference-btn');
    
    toggleBtn.addEventListener('click', () => {
      this.toggleTheme();
      this.animateToggle();
    });
    
    toggleBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.toggleTheme();
        this.animateToggle();
      }
    });
    
    if (preferenceBtn) {
      preferenceBtn.addEventListener('click', () => {
        this.setSystemTheme();
      });
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.altKey && e.key === 't') {
        e.preventDefault();
        this.toggleTheme();
        this.animateToggle();
        this.showKeyboardShortcutHint();
      }
    });
  },
  
  setupIntersectionObserver() {
    // Observe toggle visibility for performance
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    });
    
    const toggleContainer = document.querySelector('.theme-toggle-container');
    if (toggleContainer) {
      observer.observe(toggleContainer);
    }
  },
  
  toggleTheme() {
    const themes = ['dark', 'light'];
    const currentIndex = themes.indexOf(this.currentTheme);
    const nextIndex = (currentIndex + 1) % themes.length;
    this.currentTheme = themes[nextIndex];
    
    this.applyTheme(this.currentTheme);
    this.savePreference();
  },
  
  setSystemTheme() {
    this.currentTheme = 'system';
    this.applyTheme(this.systemPreference);
    this.savePreference();
    this.updatePreferenceButton();
  },
  
  applyTheme(theme) {
    const actualTheme = theme === 'system' ? this.systemPreference : theme;
    
    // Update data attribute for CSS
    document.documentElement.setAttribute('data-theme', actualTheme);
    
    // Update UI elements
    this.updateToggleUI(actualTheme);
    this.updateMetaTheme(actualTheme);
    
    // Dispatch event for other components
    window.dispatchEvent(new CustomEvent('themeChanged', { 
      detail: { theme: actualTheme, preference: this.currentTheme }
    }));
  },
  
  updateToggleUI(theme) {
    const toggleLabel = document.getElementById('toggleLabel');
    const toggle = document.getElementById('themeToggle');
    const currentThemeSpan = document.getElementById('currentTheme');
    
    if (toggleLabel) {
      toggleLabel.textContent = theme === 'light' ? 'Light Mode' : 'Dark Mode';
    }
    
    if (currentThemeSpan) {
      currentThemeSpan.textContent = theme === 'light' ? 'Light Mode' : 'Dark Mode';
    }
    
    // Update ARIA label for accessibility
    if (toggle) {
      toggle.setAttribute('aria-label', `Toggle theme - Currently ${theme} mode`);
      toggle.setAttribute('title', `Switch to ${theme === 'light' ? 'dark' : 'light'} mode`);
    }
  },
  
  updatePreferenceButton() {
    const preferenceBtn = document.querySelector('.preference-btn');
    if (preferenceBtn) {
      if (this.currentTheme === 'system') {
        preferenceBtn.classList.add('active');
        preferenceBtn.setAttribute('aria-pressed', 'true');
      } else {
        preferenceBtn.classList.remove('active');
        preferenceBtn.setAttribute('aria-pressed', 'false');
      }
    }
  },
  
  updateMetaTheme(theme) {
    // Update meta theme-color for mobile browsers
    let metaThemeColor = document.querySelector('meta[name="theme-color"]');
    if (!metaThemeColor) {
      metaThemeColor = document.createElement('meta');
      metaThemeColor.name = 'theme-color';
      document.head.appendChild(metaThemeColor);
    }
    metaThemeColor.content = theme === 'light' ? '#ffffff' : '#121212';
  },
  
  animateToggle() {
    const toggle = document.getElementById('themeToggle');
    const thumb = toggle?.querySelector('.toggle-thumb');
    
    if (thumb) {
      thumb.style.transform = 'scale(1.1)';
      setTimeout(() => {
        thumb.style.transform = '';
      }, 150);
    }
  },
  
  savePreference() {
    localStorage.setItem('ascend-theme', this.currentTheme);
  },
  
  showKeyboardShortcutHint() {
    // Optional: Show a subtle hint about the keyboard shortcut
    console.log('üí° Pro tip: Press Alt + T to toggle themes quickly');
  }
};

// data-service.js
// ===== DATA SERVICE MODULE =====
const DataService = {
  endpoints: {
    metrics: '/api/v1/metrics',
    activities: '/api/v1/activities',
    health: '/api/v1/health',
    clients: '/api/v1/clients'
  },

  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer demo-token'
  },

  async fetchMetrics() {
    try {
      // Simulate API call delay
      await new Promise(resolve => setTimeout(resolve, 800));
      return this.getMockMetrics();
    } catch (error) {
      console.warn('API call failed, using mock data:', error);
      return this.getMockMetrics();
    }
  },

  async fetchActivities() {
    try {
      await new Promise(resolve => setTimeout(resolve, 600));
      return this.getMockActivities();
    } catch (error) {
      console.warn('API call failed, using mock data:', error);
      return this.getMockActivities();
    }
  },

  async fetchHealthStatus() {
    try {
      await new Promise(resolve => setTimeout(resolve, 400));
      return this.getMockHealthStatus();
    } catch (error) {
      console.warn('API call failed, using mock data:', error);
      return this.getMockHealthStatus();
    }
  },

  getMockMetrics() {
    // Generate sample data for visualizations
    const generateHistory = (count, min, max) => {
      return Array.from({length: count}, () => 
        Math.floor(Math.random() * (max - min + 1)) + min
      );
    };
    
    const generateBreakdown = (labels) => {
      const total = 100;
      const values = [];
      let remaining = total;
      
      for (let i = 0; i < labels.length - 1; i++) {
        const value = Math.floor(Math.random() * remaining * 0.7);
        values.push(value);
        remaining -= value;
      }
      values.push(remaining);
      
      return labels.map((label, i) => ({
        label,
        value: values[i],
        color: ['#4361ee', '#4895ef', '#4cc9f0', '#7209b7'][i]
      }));
    };
    
    // Determine status based on trend
    const getStatusFromTrend = (trend) => {
      const trendValue = parseFloat(trend);
      if (trendValue > 5) return 'positive';
      if (trendValue < -2) return 'negative';
      return 'neutral';
    };
    
    // Determine status class for API
    const getApiStatusClass = (uptime) => {
      const uptimeValue = parseFloat(uptime);
      if (uptimeValue >= 99.9) return 'success';
      if (uptimeValue >= 99.5) return 'warning';
      return 'error';
    };

    return {
      clients: {
        total: 42 + Math.floor(Math.random() * 5),
        enterprise: 8,
        growth: 24,
        startup: 10,
        trend: '+12%',
        status: getStatusFromTrend('+12%'),
        history: generateHistory(12, 35, 50)
      },
      transactions: {
        volume: `${(2.5 + Math.random() * 0.5).toFixed(1)}M`,
        successRate: `${(98.5 + Math.random() * 1.5).toFixed(1)}%`,
        avgTransaction: `${(85 + Math.random() * 10).toFixed(2)}`,
        chargebacks: `${(0.02 + Math.random() * 0.02).toFixed(2)}%`,
        trend: '+18%',
        history: generateHistory(7, 20, 40)
      },
      api: {
        uptime: '99.98%',
        uptimeValue: 99.98,
        responseTime: `${(130 + Math.random() * 20).toFixed(0)}ms`,
        callsToday: (280000 + Math.floor(Math.random() * 10000)).toLocaleString(),
        errorRate: '0.02%',
        status: 'Stable',
        statusClass: getApiStatusClass(99.98)
      },
      revenue: {
        monthly: `${(82000 + Math.random() * 5000).toLocaleString()}`,
        platformFees: `${(42000 + Math.random() * 2000).toLocaleString()}`,
        transactionFees: `${(40000 + Math.random() * 3000).toLocaleString()}`,
        growthRate: `${(14 + Math.random() * 2).toFixed(1)}%`,
        trend: '+22%',
        breakdown: generateBreakdown(['Platform', 'Processing', 'Subscription', 'Other'])
      }
    };
  },

  getMockActivities() {
    const activities = [
      {
        id: 1,
        client: 'TechFlow SaaS',
        plan: 'Enterprise plan - $50K MRR',
        time: '2 hours ago',
        status: 'success',
        tier: 'enterprise'
      },
      {
        id: 2,
        client: 'DataSphere Analytics',
        plan: 'Growth plan - $25K MRR',
        time: '5 hours ago',
        status: 'success',
        tier: 'growth'
      },
      {
        id: 3,
        client: 'CloudSecure API',
        plan: 'Underwriting in progress',
        time: 'Yesterday',
        status: 'pending',
        tier: 'startup'
      }
    ];

    // Occasionally add a new activity
    if (Math.random() > 0.7) {
      const newClient = `NewClient${Math.floor(Math.random() * 100)}`;
      const tiers = ['startup', 'growth', 'enterprise'];
      activities.unshift({
        id: Date.now(),
        client: newClient,
        plan: 'Signup completed',
        time: 'Just now',
        status: 'success',
        tier: tiers[Math.floor(Math.random() * 3)]
      });
    }

    return activities;
  },

  getMockHealthStatus() {
    return [
      {
        service: 'Payment Processing',
        status: 'success',
        metric: 'All systems operational'
      },
      {
        service: 'Subscription Engine',
        status: 'success',
        metric: `Processing ${(1200 + Math.floor(Math.random() * 100)).toLocaleString()} renewals/hour`
      },
      {
        service: '3D Secure Service',
        status: Math.random() > 0.8 ? 'warning' : 'success',
        metric: Math.random() > 0.8 ? 'Elevated latency in EU region' : 'All regions operational'
      },
      {
        service: 'Fraud Detection',
        status: 'success',
        metric: `Blocked ${(20 + Math.floor(Math.random() * 10))} suspicious transactions`
      }
    ];
  }
};

// visualization-components.js
// ===== VISUALIZATION COMPONENTS =====
const VisualizationComponents = {
  // Sparkline chart for transactions
  renderSparkline(container, data, maxHeight = 40) {
    if (!data || !data.length) return;
    
    const maxValue = Math.max(...data);
    const minValue = Math.min(...data);
    const range = maxValue - minValue || 1; // Avoid division by zero
    
    container.innerHTML = '';
    
    data.forEach(value => {
      const height = ((value - minValue) / range) * maxHeight;
      const bar = document.createElement('div');
      bar.className = 'sparkline-bar';
      bar.style.height = `${height}px`;
      container.appendChild(bar);
    });
  },
  
  // Progress bar for API performance
  renderProgressBar(container, value, statusClass) {
    if (!container) return;
    
    const uptimeValue = parseFloat(value);
    const progressBar = container.querySelector('.progress-bar-fill');
    if (progressBar) {
      progressBar.style.width = `${uptimeValue}%`;
      progressBar.className = `progress-bar-fill ${statusClass}`;
    }
  },
  
  // Mini bar chart for revenue breakdown
  renderBarChart(container, data, maxHeight = 40) {
    if (!data || !data.length) return;
    
    const maxValue = Math.max(...data.map(item => item.value));
    
    container.innerHTML = '';
    
    data.forEach(item => {
      const height = (item.value / maxValue) * maxHeight;
      const bar = document.createElement('div');
      bar.className = 'bar-chart-item';
      bar.style.height = `${height}px`;
      bar.style.backgroundColor = item.color;
      bar.setAttribute('data-label', item.label);
      container.appendChild(bar);
    });
  }
};

// metrics-cards.js
// ===== METRICS CARDS COMPONENT =====
const MetricsCardsComponent = {
  container: null,
  currentData: null,

  async init(containerId) {
    this.container = document.getElementById(containerId);
    
    if (!this.container) {
      console.error('Metrics cards container not found:', containerId);
      return;
    }

    this.renderLoading();
    console.log('‚úÖ MetricsCardsComponent initialized');
  },

  render(data) {
    this.currentData = data;
    
    if (!data) {
      this.renderError('No data available');
      return;
    }

    try {
      const html = this.generateMetricsHTML(data);
      this.container.innerHTML = html;
      this.renderVisualizations(data);
      this.attachEventListeners();
      
    } catch (error) {
      console.error('Error rendering metrics cards:', error);
      this.renderError('Failed to render metrics');
    }
  },

  update(data) {
    if (!this.currentData) {
      this.render(data);
      return;
    }

    this.currentData = data;
    
    Object.keys(data).forEach(metricType => {
      const card = this.container.querySelector(`[data-metric="${metricType}"]`);
      if (card) {
        this.updateCard(card, data[metricType], metricType);
      }
    });
    
    this.renderVisualizations(data);
  },

  updateCard(card, data, metricType) {
    const valueElement = card.querySelector('.metric-value');
    const trendElement = card.querySelector('.metric-trend');
    
    if (valueElement) {
      valueElement.textContent = this.getPrimaryValue(data, metricType);
    }
    
    if (trendElement && data.trend) {
      trendElement.textContent = data.trend;
      // Update trend class based on data
      trendElement.className = `metric-trend ${data.status || 'positive'}`;
    }
    
    this.updateBreakdown(card, data, metricType);
    
    card.style.animation = 'highlight 1s ease';
    setTimeout(() => card.style.animation = '', 1000);
  },

  updateBreakdown(card, data, metricType) {
    const breakdownContainer = card.querySelector('.metric-breakdown');
    if (!breakdownContainer) return;

    const breakdownHTML = this.generateBreakdownHTML(data, metricType);
    breakdownContainer.innerHTML = breakdownHTML;
  },

  renderVisualizations(data) {
    // Render sparkline for transactions
    const transactionsChart = document.querySelector('[data-metric="transactions"] .sparkline-chart');
    if (transactionsChart && data.transactions.history) {
      VisualizationComponents.renderSparkline(transactionsChart, data.transactions.history);
    }
    
    // Render progress bar for API
    const apiProgressContainer = document.querySelector('[data-metric="api"] .progress-bar-container');
    if (apiProgressContainer && data.api.uptimeValue) {
      VisualizationComponents.renderProgressBar(
        apiProgressContainer, 
        data.api.uptimeValue, 
        data.api.statusClass
      );
    }
    
    // Render bar chart for revenue
    const revenueChart = document.querySelector('[data-metric="revenue"] .bar-chart');
    if (revenueChart && data.revenue.breakdown) {
      VisualizationComponents.renderBarChart(revenueChart, data.revenue.breakdown);
    }
  },

  generateMetricsHTML(data) {
    const { clients, transactions, api, revenue } = data;
    
    return `
      <div class="dashboard-card" data-metric="clients">
        <div class="card-header">
          <div class="card-icon">üë•</div>
          <h3 class="card-title">Active Clients</h3>
        </div>
        <div class="card-content">
          <div class="metric-display">
            <div class="metric-value">${clients.total}</div>
            <div class="metric-label">SaaS Companies</div>
            <div class="metric-trend ${clients.status}">
              <span>${clients.trend}</span>
            </div>
          </div>
            <hr style="border: 0; border-top: 0.5px solid #444444; width: 100%; margin: 20px 0;">
          <div class="metric-breakdown">
            ${this.generateBreakdownHTML(clients, 'clients')}
          </div>
        </div>
        <div class="card-status-bar ${clients.status}"></div>
      </div>

      <div class="dashboard-card" data-metric="transactions">
        <div class="card-header">
          <div class="card-icon">üí≥</div>
          <h3 class="card-title">Transaction Volume</h3>
        </div>
        <div class="card-content">
          <div class="metric-display">
            <div class="metric-value">${transactions.volume}</div>
            <div class="metric-label">Monthly Processed</div>
            <div class="metric-trend positive">
              <span>${transactions.trend}</span>
            </div>
          </div>
          <hr style="border: 0; border-top: 0.5px solid #444444; width: 100%; margin: 20px 0;">  
          <div class="viz-container sparkline-chart"></div>
          <div class="metric-breakdown">
            ${this.generateBreakdownHTML(transactions, 'transactions')}
          </div>
        </div>
        <div class="card-status-bar ${clients.status}"></div>
      </div>

      <div class="dashboard-card" data-metric="api">
        <div class="card-header">
          <div class="card-icon">üîß</div>
          <h3 class="card-title">API Performance</h3>
        </div>
        <div class="card-content">
          <div class="progress-bar-container">
            <div class="metric-value-label">
              <div class="metric-value">${api.uptime}</div>
              <div class="metric-label">Uptime</div>
            </div>
            <div class="progress-bar-track">
              <div class="progress-bar-fill ${api.statusClass}" style="width: ${api.uptimeValue}%"></div>
            </div>
          </div>
          <div class="metric-trend positive">
            <span>${api.status}</span> 
          </div> 
          <div><hr style="border: 0; border-top: 0.5px solid #444444; width: 100%; margin: 20px 0;">
            </div>
          <div class="metric-breakdown">
            ${this.generateBreakdownHTML(api, 'api')}
          </div>  
        </div>
        <div class="card-status-bar ${clients.status}"></div>
      </div>

      <div class="dashboard-card" data-metric="revenue">
        <div class="card-header">
          <div class="card-icon">üí∞</div>
          <h3 class="card-title">Revenue Metrics</h3>
        </div>
        <div class="card-content">
          <div class="metric-display">
            <div class="metric-value">${revenue.monthly}</div>
            <div class="metric-label">Monthly Revenue</div>
            <div class="metric-trend positive">
              <span>${revenue.trend}</span>
            </div>
          </div>
          <div><hr style="border: 0; border-top: 0.5px solid #444444; width: 100%; margin: 20px 0;">
            </div>
          <div class="viz-container bar-chart"></div>
          <br>  
          <div class="metric-breakdown">
            ${this.generateBreakdownHTML(revenue, 'revenue')}
          </div>
        </div>
        <div class="card-status-bar ${clients.status}"></div>
      </div>
    `;
  },

  generateBreakdownHTML(data, type) {
    switch (type) {
      case 'clients':
        return `
          <div class="breakdown-item">
            <span class="breakdown-label">Enterprise:</span>
            <span class="breakdown-value">${data.enterprise} clients</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Growth:</span>
            <span class="breakdown-value">${data.growth} clients</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Startup:</span>
            <span class="breakdown-value">${data.startup} clients</span>
          </div>
        `;
      
      case 'transactions':
        return `
          <div class="breakdown-item">
            <span class="breakdown-label">Success Rate:</span>
            <span class="breakdown-value success">${data.successRate}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Avg Transaction:</span>
            <span class="breakdown-value">${data.avgTransaction}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Chargebacks:</span>
            <span class="breakdown-value warning">${data.chargebacks}</span>
          </div>
        `;
      
      case 'api':
        return `
          <div class="breakdown-item">
            <span class="breakdown-label">Avg Response:</span>
            <span class="breakdown-value success">${data.responseTime}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">API Calls Today:</span>
            <span class="breakdown-value">${data.callsToday}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Error Rate:</span>
            <span class="breakdown-value success">${data.errorRate}</span>
          </div>
        `;
      
      case 'revenue':
        return `
          <div class="breakdown-item">
            <span class="breakdown-label">Platform Fees:</span>
            <span class="breakdown-value">${data.platformFees}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Transaction Fees:</span>
            <span class="breakdown-value">${data.transactionFees}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">MRR Growth:</span>
            <span class="breakdown-value success">${data.growthRate}</span>
          </div>
        `;
      
      default:
        return '';
    }
  },

  getPrimaryValue(data, type) {
    const valueMap = {
      clients: data.total,
      transactions: data.volume,
      api: data.uptime,
      revenue: data.monthly
    };
    
    return valueMap[type] || 'N/A';
  },

  renderLoading() {
    this.container.innerHTML = `
      <div class="dashboard-card">
        <div class="skeleton-loader" style="height: 120px;"></div>
      </div>
      <div class="dashboard-card">
        <div class="skeleton-loader" style="height: 120px;"></div>
      </div>
      <div class="dashboard-card">
        <div class="skeleton-loader" style="height: 120px;"></div>
      </div>
      <div class="dashboard-card">
        <div class="skeleton-loader" style="height: 120px;"></div>
      </div>
    `;
  },

  renderError(message) {
    this.container.innerHTML = `
      <div class="dashboard-card">
        <div class="card-content text-center">
          <div style="padding: 20px; color: var(--error-color);">
            <p>üìä</p>
            <p>${message}</p>
          </div>
        </div>
      </div>
    `;
  },

  attachEventListeners() {
    const cards = this.container.querySelectorAll('.dashboard-card');
    
    cards.forEach(card => {
      card.addEventListener('click', () => {
        const metricType = card.getAttribute('data-metric');
        this.handleCardClick(metricType, this.currentData[metricType]);
      });
    });
  },

  handleCardClick(metricType, data) {
    console.log(`Card clicked: ${metricType}`, data);
    const card = this.container.querySelector(`[data-metric="${metricType}"]`);
    card.style.transform = 'scale(0.98)';
    setTimeout(() => card.style.transform = '', 150);
  }
};

// activity-list.js
// ===== ACTIVITY LIST COMPONENT =====
const ActivityListComponent = {
  container: null,
  currentActivities: [],

  async init(containerId) {
    this.container = document.getElementById(containerId);
    
    if (!this.container) {
      console.error('Activity list container not found:', containerId);
      return;
    }

    this.renderLoading();
    console.log('‚úÖ ActivityListComponent initialized');
  },

  render(activities) {
    this.currentActivities = activities;
    
    if (!activities || !Array.isArray(activities)) {
      this.renderError('No activity data available');
      return;
    }

    try {
      const html = this.generateActivitiesHTML(activities);
      this.container.innerHTML = html;
      this.attachEventListeners();
      
    } catch (error) {
      console.error('Error rendering activities:', error);
      this.renderError('Failed to load activities');
    }
  },

  update(activities) {
    if (!this.currentActivities) {
      this.render(activities);
      return;
    }

    const newActivities = this.findNewActivities(activities, this.currentActivities);
    
    if (newActivities.length > 0) {
      this.addNewActivitiesWithAnimation(newActivities);
    }

    this.currentActivities = activities;
  },

  findNewActivities(newActivities, currentActivities) {
    const currentIds = new Set(currentActivities.map(activity => activity.id));
    return newActivities.filter(activity => !currentIds.has(activity.id));
  },

  addNewActivitiesWithAnimation(newActivities) {
    newActivities.forEach(activity => {
      const activityHTML = this.generateActivityHTML(activity);
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = activityHTML;
      const newElement = tempDiv.firstChild;
      
      newElement.style.opacity = '0';
      newElement.style.transform = 'translateY(-20px)';
      
      this.container.insertBefore(newElement, this.container.firstChild);
      
      setTimeout(() => {
        newElement.style.transition = 'all 0.3s ease';
        newElement.style.opacity = '1';
        newElement.style.transform = 'translateY(0)';
      }, 10);
    });

    const allActivities = this.container.querySelectorAll('.activity-item');
    if (allActivities.length > 10) {
      for (let i = 10; i < allActivities.length; i++) {
        allActivities[i].remove();
      }
    }
  },

  generateActivitiesHTML(activities) {
    if (activities.length === 0) {
      return `
        <div class="activity-item">
          <div class="text-center" style="padding: 20px; color: var(--text-muted);">
            <p>No recent activities</p>
          </div>
        </div>
      `;
    }

    return activities.map(activity => this.generateActivityHTML(activity)).join('');
  },

  generateActivityHTML(activity) {
    const statusIcon = activity.status === 'success' ? '‚úì' : '‚è≥';
    const statusClass = activity.status === 'success' ? 'success' : 'pending';
    
    return `
      <div class="activity-item" data-activity-id="${activity.id}">
        <div class="activity-icon ${statusClass}">${statusIcon}</div>
        <div class="activity-content">
          <div class="activity-title">${this.escapeHTML(activity.client)}</div>
          <div class="activity-description">${this.escapeHTML(activity.plan)}</div>
          <div class="activity-time">${this.escapeHTML(activity.time)}</div>
        </div>
        <div class="activity-badge ${activity.tier}">${this.formatTier(activity.tier)}</div>
      </div>
    `;
  },

  formatTier(tier) {
    const tierMap = {
      enterprise: 'Enterprise',
      growth: 'Growth',
      startup: 'Startup'
    };
    return tierMap[tier] || tier;
  },

  escapeHTML(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  },

  renderLoading() {
    this.container.innerHTML = `
      <div class="activity-item">
        <div class="skeleton-loader" style="width: 32px; height: 32px; border-radius: 50%;"></div>
        <div class="activity-content">
          <div class="skeleton-loader" style="width: 120px; height: 16px; margin-bottom: 8px;"></div>
          <div class="skeleton-loader" style="width: 180px; height: 14px; margin-bottom: 6px;"></div>
          <div class="skeleton-loader" style="width: 80px; height: 12px;"></div>
        </div>
        <div class="skeleton-loader" style="width: 60px; height: 20px; border-radius: 12px;"></div>
      </div>
    `;
  },

  renderError(message) {
    this.container.innerHTML = `
      <div class="activity-item">
        <div class="text-center" style="padding: 20px; color: var(--error-color);">
          <p>‚ö†Ô∏è</p>
          <p>${message}</p>
        </div>
      </div>
    `;
  },

  attachEventListeners() {
    const activityItems = this.container.querySelectorAll('.activity-item');
    
    activityItems.forEach(item => {
      item.addEventListener('click', () => {
        const activityId = item.getAttribute('data-activity-id');
        const activity = this.currentActivities.find(a => a.id == activityId);
        this.handleActivityClick(activity);
      });
    });
  },

  handleActivityClick(activity) {
    console.log('Activity clicked:', activity);
    const item = this.container.querySelector(`[data-activity-id="${activity.id}"]`);
    item.style.backgroundColor = 'var(--bg-tertiary)';
    setTimeout(() => item.style.backgroundColor = '', 300);
  }
};


// health-status.js
// ===== HEALTH STATUS COMPONENT =====
const HealthStatusComponent = {
  container: null,
  currentStatus: [],

  async init(containerId) {
    this.container = document.getElementById(containerId);
    
    if (!this.container) {
      console.error('Health status container not found:', containerId);
      return;
    }

    this.renderLoading();
    console.log('‚úÖ HealthStatusComponent initialized');
  },

  render(healthStatus) {
    this.currentStatus = healthStatus;
    
    if (!healthStatus || !Array.isArray(healthStatus)) {
      this.renderError('No health status data available');
      return;
    }

    try {
      const html = this.generateHealthHTML(healthStatus);
      this.container.innerHTML = html;
      this.attachEventListeners();
      
    } catch (error) {
      console.error('Error rendering health status:', error);
      this.renderError('Failed to load health status');
    }
  },

  update(healthStatus) {
    if (!this.currentStatus) {
      this.render(healthStatus);
      return;
    }

    this.currentStatus = healthStatus;
    
    healthStatus.forEach((status) => {
      const healthItem = this.container.querySelector(`[data-service="${this.slugify(status.service)}"]`);
      if (healthItem) {
        this.updateHealthItem(healthItem, status);
      }
    });
  },

  updateHealthItem(healthItem, status) {
    const statusElement = healthItem.querySelector('.health-status');
    const metricElement = healthItem.querySelector('.health-metric');
    
    if (statusElement) {
      statusElement.className = `health-status ${status.status}`;
    }
    
    if (metricElement) {
      metricElement.textContent = status.metric;
    }
    
    const currentStatus = healthItem.getAttribute('data-status');
    if (currentStatus !== status.status) {
      healthItem.style.animation = 'pulse 0.5s ease';
      setTimeout(() => healthItem.style.animation = '', 500);
      healthItem.setAttribute('data-status', status.status);
    }
  },

  generateHealthHTML(healthStatus) {
    return healthStatus.map(status => this.generateHealthItemHTML(status)).join('');
  },

  generateHealthItemHTML(status) {
    return `
      <div class="health-item" data-service="${this.slugify(status.service)}" data-status="${status.status}">
        <div class="health-status ${status.status}"></div>
        <div class="health-info">
          <div class="health-title">${this.escapeHTML(status.service)}</div>
          <div class="health-metric">${this.escapeHTML(status.metric)}</div>
        </div>
      </div>
    `;
  },

  slugify(text) {
    return text.toLowerCase().replace(/[^\w]+/g, '-');
  },

  escapeHTML(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  },

  renderLoading() {
    this.container.innerHTML = `
      <div class="health-item">
        <div class="skeleton-loader" style="width: 12px; height: 12px; border-radius: 50%;"></div>
        <div class="health-info">
          <div class="skeleton-loader" style="width: 120px; height: 16px; margin-bottom: 8px;"></div>
          <div class="skeleton-loader" style="width: 180px; height: 14px;"></div>
        </div>
      </div>
      <div class="health-item">
        <div class="skeleton-loader" style="width: 12px; height: 12px; border-radius: 50%;"></div>
        <div class="health-info">
          <div class="skeleton-loader" style="width: 120px; height: 16px; margin-bottom: 8px;"></div>
          <div class="skeleton-loader" style="width: 180px; height: 14px;"></div>
        </div>
      </div>
      <div class="health-item">
        <div class="skeleton-loader" style="width: 12px; height: 12px; border-radius: 50%;"></div>
        <div class="health-info">
          <div class="skeleton-loader" style="width: 120px; height: 16px; margin-bottom: 8px;"></div>
          <div class="skeleton-loader" style="width: 180px; height: 14px;"></div>
        </div>
      </div>
      <div class="health-item">
        <div class="skeleton-loader" style="width: 12px; height: 12px; border-radius: 50%;"></div>
        <div class="health-info">
          <div class="skeleton-loader" style="width: 120px; height: 16px; margin-bottom: 8px;"></div>
          <div class="skeleton-loader" style="width: 180px; height: 14px;"></div>
        </div>
      </div>
    `;
  },

  renderError(message) {
    this.container.innerHTML = `
      <div class="health-item">
        <div class="text-center" style="padding: 20px; color: var(--error-color);">
          <p>üîÑ</p>
          <p>${message}</p>
        </div>
      </div>
    `;
  },

  attachEventListeners() {
    const healthItems = this.container.querySelectorAll('.health-item');
    
    healthItems.forEach(item => {
      item.addEventListener('click', () => {
        const service = item.getAttribute('data-service');
        const status = this.currentStatus.find(s => this.slugify(s.service) === service);
        this.handleHealthItemClick(status);
      });
    });
  },

  handleHealthItemClick(status) {
    console.log('Health item clicked:', status);
    const item = this.container.querySelector(`[data-service="${this.slugify(status.service)}"]`);
    item.style.transform = 'scale(0.98)';
    setTimeout(() => item.style.transform = '', 150);
  }
};

// app.js
// ===== MAIN APPLICATION =====
const App = {
  config: {
    refreshInterval: 15000, // 15 seconds
    criticalRefreshInterval: 10000 // 10 seconds
  },

  state: {
    isLoading: false,
    lastUpdate: null
  },

  async init() {
    try {
      console.log('üöÄ Initializing Ascend Payments Platform...');
      
      await this.initializeComponents();
      this.setupEventListeners();
      await this.loadInitialData();
      this.startBackgroundUpdates();
      
      console.log('‚úÖ Application initialized successfully');
      
    } catch (error) {
      console.error('‚ùå Application initialization failed:', error);
      this.handleError(error);
    }
  },

  async initializeComponents() {
    await MetricsCardsComponent.init('metricsCardsContainer');
    await ActivityListComponent.init('activityListContainer');
    await HealthStatusComponent.init('healthStatusContainer');
  },

  setupEventListeners() {
    // Navigation
    const navItems = document.querySelectorAll('.nav-item[data-route]');
    navItems.forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const route = item.getAttribute('data-route');
        this.handleNavigation(route, item);
      });
    });

    // Global error handling
    window.addEventListener('error', this.handleGlobalError.bind(this));
    window.addEventListener('unhandledrejection', this.handlePromiseRejection.bind(this));
  },

  handleNavigation(route, clickedItem) {
    console.log('Navigating to:', route);
    
    // Update active nav item
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.remove('active');
    });
    clickedItem.classList.add('active');
    
    // Update page title
    document.title = `${route.charAt(0).toUpperCase() + route.slice(1)} - Ascend Payments`;
    
    // Show notification for non-dashboard routes
    if (route !== 'dashboard') {
      this.showNotification(`${route} view coming soon!`, 'info');
    }
  },

  async loadInitialData() {
    this.state.isLoading = true;
    
    try {
      const [metrics, activities, health] = await Promise.all([
        DataService.fetchMetrics(),
        DataService.fetchActivities(),
        DataService.fetchHealthStatus()
      ]);

      MetricsCardsComponent.render(metrics);
      ActivityListComponent.render(activities);
      HealthStatusComponent.render(health);

      this.state.lastUpdate = new Date();
      this.state.isLoading = false;

      console.log('üìä Initial data loaded successfully');
      this.showNotification('Dashboard loaded successfully!', 'success');

    } catch (error) {
      console.error('Failed to load initial data:', error);
      this.useMockData();
      this.state.isLoading = false;
      this.showNotification('Using demo data - API unavailable', 'warning');
    }
  },

  useMockData() {
    console.warn('Using mock data as fallback');
    
    const mockMetrics = DataService.getMockMetrics();
    const mockActivities = DataService.getMockActivities();
    const mockHealth = DataService.getMockHealthStatus();

    MetricsCardsComponent.render(mockMetrics);
    ActivityListComponent.render(mockActivities);
    HealthStatusComponent.render(mockHealth);
  },

  startBackgroundUpdates() {
    // Update data periodically
    setInterval(async () => {
      if (!this.state.isLoading && document.visibilityState === 'visible') {
        await this.refreshData();
      }
    }, this.config.refreshInterval);

    // Real-time updates for critical metrics
    setInterval(() => {
      if (document.visibilityState === 'visible') {
        this.refreshCriticalMetrics();
      }
    }, this.config.criticalRefreshInterval);
  },

  async refreshData() {
    try {
      const [metrics, activities, health] = await Promise.all([
        DataService.fetchMetrics(),
        DataService.fetchActivities(),
        DataService.fetchHealthStatus()
      ]);

      MetricsCardsComponent.update(metrics);
      ActivityListComponent.update(activities);
      HealthStatusComponent.update(health);

      this.state.lastUpdate = new Date();
      
      console.log('üîÑ Data updated at:', new Date().toLocaleTimeString());

    } catch (error) {
      console.warn('Background update failed:', error);
    }
  },

  async refreshCriticalMetrics() {
    try {
      const metrics = await DataService.fetchMetrics();
      MetricsCardsComponent.update(metrics);
    } catch (error) {
      console.warn('Critical metrics update failed:', error);
    }
  },

  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    const bgColor = type === 'success' ? 'var(--success-color)' : 
                    type === 'warning' ? 'var(--warning-color)' : 
                    type === 'error' ? 'var(--error-color)' : 'var(--primary-color)';
    
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${bgColor};
      color: white;
      padding: 12px 16px;
      border-radius: var(--border-radius);
      z-index: 10000;
      box-shadow: var(--shadow);
      max-width: 300px;
      animation: slideIn 0.3s ease;
    `;
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => {
        if (document.body.contains(notification)) {
          document.body.removeChild(notification);
        }
      }, 300);
    }, 3000);
  },

  handleGlobalError(event) {
    console.error('Global error:', event.error);
    this.showNotification('An unexpected error occurred', 'error');
  },

  handlePromiseRejection(event) {
    console.error('Unhandled promise rejection:', event.reason);
    this.showNotification('Async operation failed', 'error');
  },

  handleError(error) {
    console.error('Application error:', error);
    this.showNotification(error.message || 'An error occurred', 'error');
  }
};

// Initialize enhanced theme manager
document.addEventListener('DOMContentLoaded', () => {
  EnhancedThemeManager.init();
  App.init();
});

// Export for debugging
window.AscendPaymentsApp = App;
window.ThemeManager = EnhancedThemeManager;
</script>
</body>
</html>
